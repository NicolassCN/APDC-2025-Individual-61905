<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management System</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      h1 {
        color: #333;
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
      }
      h2 {
        color: #555;
        margin-top: 20px;
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 5px;
      }
      .endpoint {
        margin-bottom: 15px;
        padding: 10px;
        background-color: #e9e9e9;
        border-radius: 3px;
      }
      .method {
        display: inline-block;
        padding: 3px 8px;
        background-color: #4CAF50;
        color: white;
        border-radius: 3px;
        font-weight: bold;
        margin-right: 10px;
      }
      .url {
        font-family: monospace;
        color: #333;
      }
      .description {
        margin-top: 10px;
        color: #666;
      }
      .credentials {
        background-color: #fff3cd;
        padding: 10px;
        border-radius: 3px;
        margin-top: 10px;
      }
      footer {
        margin-top: 30px;
        text-align: center;
        color: #777;
        font-size: 0.9em;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>ADC: User Management System</h1>
      
      <div id="message" class="message"></div>
      
      <!-- Login Section -->
      <section id="login-section" class="section">
        <h2>Login</h2>
        <form id="login-form">
          <div class="form-group">
            <label for="login-username">Username:</label>
            <input type="text" id="login-username" name="username" required>
          </div>
          <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" name="password" required>
          </div>
          <button type="submit">Login</button>
          <p>Don't have an account? <a href="#" id="show-register">Register here</a></p>
        </form>
      </section>
      
      <!-- Register Section -->
      <section id="register-section" class="section" style="display: none;">
        <h2>Register</h2>
        <form id="register-form">
          <div class="form-group">
            <label for="register-email">Email:</label>
            <input type="email" id="register-email" name="email" required>
          </div>
          <div class="form-group">
            <label for="register-username">Username:</label>
            <input type="text" id="register-username" name="username" required>
          </div>
          <div class="form-group">
            <label for="register-fullname">Full Name:</label>
            <input type="text" id="register-fullname" name="fullName" required>
          </div>
          <div class="form-group">
            <label for="register-phone">Phone:</label>
            <input type="tel" id="register-phone" name="phone" required>
          </div>
          <div class="form-group">
            <label for="register-password">Password:</label>
            <input type="password" id="register-password" name="password" required>
          </div>
          <div class="form-group">
            <label for="register-profile">Profile:</label>
            <select id="register-profile" name="profile" required>
              <option value="public">Public</option>
              <option value="private">Private</option>
            </select>
          </div>
          <button type="submit">Register</button>
          <p>Already have an account? <a href="#" id="show-login">Login here</a></p>
        </form>
      </section>
      
      <!-- User Section -->
      <section id="user-section" class="section" style="display: none;">
        <h2>Welcome, <span id="user-name"></span>!</h2>
        <button id="logout-btn">Logout</button>
      </section>
      
      <!-- Admin Section -->
      <section id="admin-section" class="section" style="display: none;">
        <h2>Admin Controls</h2>
        
        <!-- User List Section -->
        <div class="user-list-section">
          <h3>Registered Users</h3>
          <div id="user-list" class="user-list"></div>
        </div>
        
        <!-- Change Role Form -->
        <form id="change-role-form">
          <h3>Change User Role</h3>
          <div class="form-group">
            <label for="role-username">Username:</label>
            <input type="text" id="role-username" name="targetUsername" required>
          </div>
          <div class="form-group">
            <label for="new-role">New Role:</label>
            <select id="new-role" name="newRole" required>
              <option value="ENDUSER">End User</option>
              <option value="BACKOFFICE">Back Office</option>
              <option value="ADMIN">Admin</option>
            </select>
          </div>
          <button type="submit">Change Role</button>
        </form>
        
        <!-- Change Account State Form -->
        <form id="change-state-form">
          <h3>Change Account State</h3>
          <div class="form-group">
            <label for="state-username">Username:</label>
            <input type="text" id="state-username" name="targetUsername" required>
          </div>
          <div class="form-group">
            <label for="new-state">New State:</label>
            <select id="new-state" name="newState" required>
              <option value="ACTIVE">Active</option>
              <option value="INACTIVE">Inactive</option>
            </select>
          </div>
          <button type="submit">Change State</button>
        </form>
        
        <!-- Remove User Form -->
        <form id="remove-user-form">
          <h3>Remove User Account</h3>
          <div class="form-group">
            <label for="remove-username">Username or Email:</label>
            <input type="text" id="remove-username" name="targetUsername" required>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="is-email" name="isEmail">
              Target is an email address
            </label>
          </div>
          <button type="submit">Remove User</button>
        </form>
      </section>
    </div>
    
    <footer>
      <p>Copyright: ADC-PEI, FCT NOVA 2025</p>
    </footer>
    
    <script src="js/app.js"></script>
    <script>
      // Initialize UI
      document.addEventListener('DOMContentLoaded', () => {
        UI.updateAuthUI();
        
        // Login form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          try {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            await ApiClient.login({ username, password });
            UI.updateAuthUI();
            UI.showMessage('Login successful!');
          } catch (error) {
            UI.showMessage(error.message, true);
          }
        });
        
        // Register form
        document.getElementById('register-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          try {
            const userData = {
              email: document.getElementById('register-email').value,
              username: document.getElementById('register-username').value,
              fullName: document.getElementById('register-fullname').value,
              phone: document.getElementById('register-phone').value,
              password: document.getElementById('register-password').value,
              profile: document.getElementById('register-profile').value
            };
            
            if (!Validator.validateEmail(userData.email)) {
              throw new Error('Invalid email format');
            }
            if (!Validator.validatePassword(userData.password)) {
              throw new Error('Password must be at least 8 characters long and contain at least one number, one uppercase letter, one lowercase letter, and one special character');
            }
            if (!Validator.validatePhone(userData.phone)) {
              throw new Error('Invalid phone number format');
            }
            
            await ApiClient.register(userData);
            UI.showMessage('Registration successful! Please login.');
            UI.showLoginForm();
          } catch (error) {
            UI.showMessage(error.message, true);
          }
        });
        
        // Logout button
        document.getElementById('logout-btn').addEventListener('click', async () => {
          await ApiClient.logout();
          UI.updateAuthUI();
          UI.showMessage('Logged out successfully');
        });
        
        // Change role form
        document.getElementById('change-role-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          try {
            const roleData = {
              targetUsername: document.getElementById('role-username').value,
              newRole: document.getElementById('new-role').value
            };
            await ApiClient.changeRole(roleData);
            UI.showMessage('Role changed successfully');
          } catch (error) {
            UI.showMessage(error.message, true);
          }
        });
        
        // Change state form
        document.getElementById('change-state-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          try {
            const stateData = {
              targetUsername: document.getElementById('state-username').value,
              newState: document.getElementById('new-state').value
            };
            await ApiClient.changeAccountState(stateData);
            UI.showMessage('Account state changed successfully');
          } catch (error) {
            UI.showMessage(error.message, true);
          }
        });
        
        // Remove user form
        document.getElementById('remove-user-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          try {
            const userData = {
              targetUsername: document.getElementById('remove-username').value,
              isEmail: document.getElementById('is-email').checked
            };
            await ApiClient.removeUser(userData);
            UI.showMessage('User removed successfully');
          } catch (error) {
            UI.showMessage(error.message, true);
          }
        });
        
        // Form navigation
        document.getElementById('show-register').addEventListener('click', (e) => {
          e.preventDefault();
          UI.showRegisterForm();
        });
        
        document.getElementById('show-login').addEventListener('click', (e) => {
          e.preventDefault();
          UI.showLoginForm();
        });
      });
    </script>
  </body>
</html>
